/*!
 * flying-square
 * 
 * 
 * @author [object Object]
 * @version 1.0.0
 * Copyright 2015.
 */
var Game={Socket:io("localhost:3000"),Map:{},Players:{},PlayersPosition:{},Player:""};Game.Boot={init:function(){this.game.stage.backgroundColor="#e2e2e2",this.input.maxPointers=1,this.stage.disableVisibilityChange=!0},preload:function(){this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setScreenSize(!0),this.load.image("progressBar","/gfx/progress_bar.png"),Game.Socket.reqMap(game.height)},create:function(){this.physics.startSystem(Phaser.Physics.ARCADE),this.state.start("Preloader")}},Game.Gameover={create:function(){this.keySpacebar=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);var e=this.add.text(this.world.centerX,this.world.centerY,"You "+Game.Players[Game.Player].place,{font:"Squada One",fontSize:96,fill:"#333"});e.angle=(2+5*Math.random())*(Math.random()>.5?1:-1),e.anchor.setTo(.5,.5);var t=this.add.text(this.world.centerX,this.world.centerY+100,"PRESS SPACEBAR TO START MENU",{font:"Squada One",fontSize:35,fill:"#333"});t.angle=(2+5*Math.random())*(Math.random()>.5?1:-1),t.anchor.setTo(.5,.5);var a=this.add.tween(t);a.to({angle:-t.angle},200+200*Math.random(),Phaser.Easing.Linear.None,!0,0,1e3,!0);var i=this.add.emitter(this.world.centerX,this.world.height+20,100);i.makeParticles(this.cache.getBitmapData("square")),i.maxParticleScale=1.2,i.minParticleScale=.2,i.setYSpeed(-100,-100),i.setXSpeed(-30,30),i.gravity=0,i.width=this.world.width,i.minRotation=0,i.maxRotation=45,i.flow(25e3,500),this.keySpacebar.onDown.addOnce(function(){this.state.start("Menu")},this)}},Game.Menu={create:function(){this.music=this.add.audio("menu-music",.5,!0),this.keySpacebar=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);var e=this.add.text(this.world.centerX,0,"FlyingSquare!",{font:"Squada One",fontSize:100,fill:"#333"});e.anchor.setTo(.5,.5);var t=this.add.tween(e);t.to({y:this.world.centerY-200},1e3).easing(Phaser.Easing.Bounce.Out).start();var a=this.add.text(this.world.centerX,0,"Players:",{font:"Squada One",fontSize:30,fill:"#333"});a.anchor.setTo(.5,.5);var i=this.add.tween(a);i.to({y:this.world.centerY-80},1e3).easing(Phaser.Easing.Bounce.Out).start();var o=this.add.emitter(this.world.centerX,this.world.height+20,100);o.makeParticles(this.cache.getBitmapData("square")),o.maxParticleScale=1.2,o.minParticleScale=.2,o.setYSpeed(-100,-100),o.setXSpeed(-30,30),o.gravity=0,o.width=this.world.width,o.minRotation=0,o.maxRotation=45,o.flow(25e3,500),Game.Menu.countUser=Game.Players.count,Game.Menu.players=this.add.graphics(0,0),Game.Menu.flags={identifier:!0,message:!0},Game.Menu.renderConnectedUsers(),Game.Menu.renderStartMessage(),this.keySpacebar.onDown.addOnce(function(){Game.Socket.playerStart(),this.state.start("Waiting")},this)},update:function(){Game.Menu.countUser!=Game.Players.count&&(Game.Menu.countUser=Game.Players.count,Game.Menu.renderConnectedUsers())},renderConnectedUsers:function(){var e=0,t=0;Game.Menu.players.clear();for(var a in Game.Players)if("count"!=a){var i=Phaser.Color.hexToColor(Game.Players[a].color);i=Phaser.Color.getColor(i.r,i.g,i.b);var o=40;a==Game.Player&&(o=55),Game.Menu.players.beginFill(i,1),t++,e=60*t-150,Game.Menu.players.drawCircle(this.world.centerX+e,this.world.centerY,o),a==Game.Player&&Game.Menu.flags.identifier&&(Game.Menu.flags.identifier=!1,Game.Menu.you=this.add.text(this.world.centerX+e-7,this.world.centerY-15,"Y",{font:"Squada One",fontSize:35,fill:"#FFFFFF"}),Game.Menu.you.angle=(2+5*Math.random())*(Math.random()>.5?1:-1),Game.Menu.youTween=this.add.tween(Game.Menu.you),Game.Menu.youTween.to({angle:-Game.Menu.you.angle},600,Phaser.Easing.Linear.None,!0,0,2e3,!0)),Game.Menu.flags.identifier||a!=Game.Player||(Game.Menu.you.position.x=this.world.centerX+e-7)}},renderStartMessage:function(){var e="PRESS SPACEBAR TO BEGIN";if(0==Game.Player&&(e="ALL SLOTS OCCEPIED"),Game.Menu.flags.message){Game.Menu.flags.message=!1;var t=this.add.text(this.world.centerX,this.world.centerY+100,e,{font:"Squada One",fontSize:40,fill:"#333"});t.angle=(2+5*Math.random())*(Math.random()>.5?1:-1),t.anchor.setTo(.5,.5);var a=this.add.tween(t);a.to({angle:-t.angle},200+200*Math.random(),Phaser.Easing.Linear.None,!0,0,1e3,!0)}}},Game.Play={create:function(){Game.Socket.started(),this.tick=0,this.gameMusic=this.add.audio("background-music",.5,!0),this.explosion=this.add.audio("explosion",1,!1),this.keySpacebar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.readyToPlay=!1,this.hasStarted=!1,this.dead=!1,this.speed=-250,this.speedInterval=200,this.speedGain=-0,this.speedMin=-5e3,this.variance=70,this.blockSize=20,this.createBlockSets(),this.scoreStyle={font:"40px Squada One",fill:"#fff",align:"center"},this.textScore=game.add.text(game.width/2,game.height/2-320,"SCORE: 0",this.scoreStyle),this.textScore.anchor.set(.5,.5),this.game.device.localStorage&&(localStorage.bestScoreCurvy?this.bestScore=localStorage.bestScoreCurvy:(localStorage.bestScoreCurvy=0,this.bestScore=0),this.textBest=game.add.text(game.width/2,game.height/2+340,"BEST: "+this.bestScore,this.scoreStyle),this.textBest.anchor.set(.5,.5)),this.readyToPlay=!0,this.emitterDark=game.add.emitter(0,0,1e3),this.emitterDark.makeParticles(game.cache.getBitmapData("square")),this.emitterDark.minParticleScale=.1,this.emitterDark.maxParticleScale=.5,this.emitterDark.setYSpeed(-15,15),this.emitterDark.setXSpeed(-15,15),this.emitterDark.gravity=-10;var e={};this.heroes={};for(var t in Game.Players)"count"!=t&&(e[t]=this.add.bitmapData(32,32),e[t].context.fillStyle=Game.Players[t].color,e[t].context.fillRect(0,0,32,32),this.cache.addBitmapData(t,e[t]));this.startGame()},update:function(){var e=this;this.hasStarted&&(this.tick%this.speedInterval!==0||this.dead?this.dead&&(this.speed*=.99):this.speed>this.speedMin&&(this.speed+=this.speedGain),this.blockSets.forEach(function(e){e.update()}),this.textScore.setText("SCORE: "+this.tick),this.game.device.localStorage&&this.textBest.setText("BEST: "+Math.max(this.tick,this.bestScore)),e.emitterDark.forEachAlive(function(t){t.alpha=t.lifespan/e.emitterDark.lifespan}),this.dead||this.tick++)},startGame:function(){!this.hasStarted&&this.readyToPlay&&(this.hasStarted=!0)},createBlockSets:function(){this.blockSets=[],this.blockSets.push(new Game.Blocks({},this))},gameover:function(){this.dead||(this.dead=!0,this.explosion.play(),this.gameMusic.stop(),this.tick>this.bestScore&&(localStorage.bestScoreCurvy=this.tick),game.time.events.add(1.5*Phaser.Timer.SECOND,function(){game.state.start("Gameover")},self))}},Game.Preloader={preload:function(){var e=this.add.text(this.world.centerX,this.world.centerY,"LOADING...",{font:"Squada One",fontSize:200,fill:"#333"});e.anchor.setTo(.5,.5),this.load.audio("menu-music",["/audio/menu.mp3","/audio/menu.ogg"]),this.load.audio("background-music",["/audio/background.mp3","/audio/background.ogg"]),this.load.audio("explosion",["/audio/explosion.mp3","/audio/explosion.ogg"]);var t=this.add.bitmapData(20,20);t.context.fillStyle="#333",t.context.fillRect(0,0,20,20),this.cache.addBitmapData("square",t);var a=this.add.bitmapData(1,1);a.context.fillStyle="#444",a.context.fillRect(0,0,1,1),this.cache.addBitmapData("block",a)},create:function(){this.time.events.add(.5*Phaser.Timer.SECOND,function(){this.state.start("Menu")},this)},update:function(){}},Game.Waiting={create:function(){var e=this.add.text(this.world.centerX,this.world.centerY,"Waiting for start of players",{font:"Squada One",fontSize:66,fill:"#333"});e.angle=(2+5*Math.random())*(Math.random()>.5?1:-1),e.anchor.setTo(.5,.5);var t=this.add.tween(e);t.to({angle:-e.angle},100+500*Math.random(),Phaser.Easing.Linear.None,!0,0,1e3,!0);var a=this.add.emitter(this.world.centerX,this.world.height+20,100);a.makeParticles(this.cache.getBitmapData("square")),a.maxParticleScale=1.2,a.minParticleScale=.2,a.setYSpeed(-100,-100),a.setXSpeed(-30,30),a.gravity=0,a.width=this.world.width,a.minRotation=0,a.maxRotation=45,a.flow(25e3,500)}},Game.Blocks=function(e,t){var a=this;a.state=t,a.blockGroup=game.add.group(),a.blockGroup.enableBody=!0,a.blockGroup.createMultiple(300,game.cache.getBitmapData("block")),a.tick=0,a.tracer={y:game.height/2-300,yMin:150,yMax:game.height-100,yVariance:a.state.variance,h:500,hMin:300,hMax:700,hVariance:a.state.variance},a.fillScreen(0,!0)},Game.Blocks.prototype.update=function(){var e=this,t=100,a=0;e.blockGroup.forEachAlive(function(i){e.state.hasStarted&&(i.body.velocity.x=e.state.speed),t=Math.min(t,i.body.x+e.state.blockSize),a=Math.max(a,i.body.x+e.state.blockSize)}),e.blockGroup.forEachAlive(function(e){e.x+e.body.width<0&&e.kill()}),e.fillScreen(a,!1)},Game.Blocks.prototype.fillScreen=function(e,t){var a=this;if(t||a.state.hasStarted)for(;e<game.width+a.state.blockSize-a.state.speed;){a.tracer=Game.Map.shift(),a.tick++;var i,o,s,r;i=0,o=a.tracer.y,s=o+a.tracer.h,r=game.height-s,newBlockTop=a.createOne(e,i,a.state.blockSize,o),newBlockBot=a.createOne(e,s,a.state.blockSize,r),t||(newBlockTop.body.velocity.x=a.state.speed,newBlockBot.body.velocity.x=a.state.speed),e+=a.state.blockSize}},Game.Blocks.prototype.createOne=function(e,t,a,i){var o=this;if(o.blockGroup.countDead())var s=o.blockGroup.getFirstDead();else var s=o.blockGroup.create(e,t,game.cache.getBitmapData("block"));return s.reset(e,t),s.body.allowGravity=!1,s.body.immovable=!0,s.scale.x=a+10,s.scale.y=i+10,s},Copter=function(e,t){this.state=e,Phaser.Sprite.call(this,game,200,game.height/2,game.cache.getBitmapData(t)),this.anchor.setTo(.5,.5),game.physics.arcade.enableBody(this),this.body.allowGravity=!0,this.body.width=32,this.body.height=32,this.body.gravity.y=1e3,this.player=t,game.add.existing(this)},Copter.prototype=Object.create(Phaser.Sprite.prototype),Copter.prototype.constructor=Copter,Copter.prototype.update=function(){this.state.hasStarted&&!this.state.dead&&(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&(this.body.velocity.y-=35),this.body.velocity.y<=-300&&(this.body.velocity.y=-300),this.angle=this.body.velocity.y/6-10)},Copter.prototype.die=function(){this.state.dead||(this.state.emitterDark.x=this.x,this.state.emitterDark.y=this.y,this.state.emitterDark.start(!0,2e3,null,100),this.state.emitterDark.forEachAlive(function(e){e.body.velocity.x+=this.state.speed/2}),this.alpha=0,this.state.gameover())},Phaser.Utils.Rand=function(e,t){return game.rnd.integerInRange(1e3*e,1e3*t)/1e3},Game.Socket.on("playerConnected",function(e){Game.Player=e}),Game.Socket.on("getAllPlayers",function(e){Game.Players=e}),Game.Socket.on("start",function(){game.state.start("Play")}),Game.Socket.playerStart=function(){Game.Socket.emit("playerStart",Game.Socket.id)},Game.Socket.started=function(){Game.Socket.emit("started",Game.Socket.id)},Game.Socket.reqPosition=function(){Game.Socket.emit("reqPosition",Game.Socket.id)},Game.Socket.resPosition=function(e){Game.Socket.on("resPosition",function(t){e(t)})},Game.Socket.sendingDead=function(){Game.Socket.emit("sendingDead",Game.Socket.id)},Game.Socket.reqMap=function(e){Game.Socket.emit("getMap",e)},Game.Socket.on("getMap",function(e){console.log(e),Game.Map=e});var innerWidth=window.innerWidth,innerHeight=window.innerHeight,gameRatio=innerWidth/innerHeight,game=new Phaser.Game(Math.ceil(800*gameRatio),800,Phaser.AUTO,"gameContainer");game.global={},game.state.add("Boot",Game.Boot),game.state.add("Preloader",Game.Preloader),game.state.add("Menu",Game.Menu),game.state.add("Waiting",Game.Waiting),game.state.add("Play",Game.Play),game.state.add("Gameover",Game.Gameover),game.state.start("Boot");
//# sourceMappingURL=app.js.map